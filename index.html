<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DEXTER | FREE TIER</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-blue: #00f3ff;
            --neon-purple: #bc13fe;
            --neon-red: #ff0055;
            --neon-yellow: #ffee00;
            --neon-green: #39ff14;
            --bg-dark: #050505;
            --panel-bg: rgba(10, 10, 16, 0.95);
            --font-main: 'Rajdhani', sans-serif;
            --font-tech: 'Share Tech Mono', monospace;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background-color: var(--bg-dark); color: white; font-family: var(--font-main);
            height: 100vh; overflow: hidden; display: flex; flex-direction: column;
        }
        .scanline {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, transparent 50%, rgba(0,0,0,0.4) 51%);
            background-size: 100% 4px; pointer-events: none; z-index: 100; opacity: 0.5;
        }
        .cyber-grid {
            position: absolute; width: 200%; height: 200%;
            background-image: linear-gradient(rgba(0, 243, 255, 0.08) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 243, 255, 0.08) 1px, transparent 1px);
            background-size: 40px 40px; transform: perspective(500px) rotateX(60deg) translateY(-100px) translateZ(-200px);
            animation: gridMove 20s linear infinite; z-index: 0;
        }
        @keyframes gridMove { 0% { transform: perspective(500px) rotateX(60deg) translateY(0) translateZ(-200px); } 100% { transform: perspective(500px) rotateX(60deg) translateY(40px) translateZ(-200px); } }
        
        #particleCanvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1;
        }
        
        .gate-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.98);
            z-index: 9999; display: flex; justify-content: center; align-items: center; backdrop-filter: blur(20px);
        }
        .gate-box {
            width: 90%; max-width: 600px; border: 2px solid var(--neon-red); background: rgba(15, 5, 5, 0.95);
            padding: 40px; text-align: center; box-shadow: 0 0 60px rgba(255, 0, 85, 0.2);
            clip-path: polygon(10% 0, 100% 0, 100% 90%, 90% 100%, 0 100%, 0 10%);
        }
        .gate-title { color: var(--neon-red); font-size: 2.2rem; font-family: var(--font-tech); letter-spacing: 3px; margin-bottom: 20px; animation: glitch 2s infinite; }
        .gate-text { color: #d1d5db; text-align: left; margin-bottom: 30px; line-height: 1.6; font-size: 1rem; border-top: 1px solid rgba(255,0,0,0.3); border-bottom: 1px solid rgba(255,0,0,0.3); padding: 20px 0; }
        .accept-btn { background: var(--neon-red); color: white; font-family: var(--font-tech); font-size: 1.1rem; padding: 15px 40px; border: none; cursor: pointer; letter-spacing: 2px; text-transform: uppercase; transition: all 0.3s; }
        .accept-btn:hover { background: white; color: black; box-shadow: 0 0 20px var(--neon-red); }

        #maintenance-gate { z-index: 10001; }
        .maintenance-box {
            border-color: var(--neon-yellow);
            background: rgba(25, 20, 5, 0.95);
            box-shadow: 0 0 60px rgba(255, 238, 0, 0.3);
        }
        .maintenance-title {
            color: var(--neon-yellow);
            font-size: 2rem;
        }
        .maintenance-icon {
            font-size: 4rem;
            color: var(--neon-yellow);
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        .btn-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .proceed-btn {
            background: var(--neon-blue);
            color: white;
        }
        .proceed-btn:hover {
            background: white;
            color: var(--neon-blue);
            box-shadow: 0 0 20px var(--neon-blue);
        }
     
        #expiry-gate { display: none; z-index: 10000; }
        .upgrade-btn { background: var(--neon-yellow); color: black; margin-top: 10px; }
        
        #main-interface { display: flex; height: 100%; z-index: 10; padding: 25px; gap: 25px; filter: blur(20px); opacity: 0.2; transition: all 1s ease; }
        .sidebar { width: 320px; display: flex; flex-direction: column; gap: 20px; }
        .defender-unit { border: 1px solid var(--neon-blue); background: var(--panel-bg); padding: 0; box-shadow: 0 0 15px rgba(0, 243, 255, 0.05); display: flex; flex-direction: column; }
        .defender-header { display: flex; justify-content: space-between; background: rgba(0, 243, 255, 0.15); color: var(--neon-blue); font-family: var(--font-tech); font-size: 0.85rem; padding: 10px 15px; letter-spacing: 1px; }
        
        .timer-box {
            padding: 15px; border: 1px solid var(--neon-red); background: rgba(255, 0, 0, 0.05);
            text-align: center; margin-bottom: 20px; position: relative; overflow: hidden;
        }
        .timer-label { font-family: var(--font-tech); font-size: 0.8rem; color: var(--neon-red); letter-spacing: 2px; margin-bottom: 5px; }
        .timer-digits { font-family: var(--font-tech); font-size: 2.5rem; color: white; text-shadow: 0 0 10px var(--neon-red); }
        .timer-sweep {
            position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,0,85,0.3), transparent);
            animation: timerSweep 3s ease-in-out infinite;
        }
        @keyframes timerSweep { 0%, 100% { left: -100%; } 50% { left: 100%; } }
        
        .system-stats { border: 1px solid var(--neon-green); padding: 15px; background: rgba(57, 255, 20, 0.02); }
        .stat-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .stat-label { font-family: var(--font-tech); font-size: 0.75rem; color: var(--neon-green); letter-spacing: 1px; }
        .stat-bar-container { flex: 1; height: 8px; background: rgba(0,0,0,0.5); margin: 0 10px; border: 1px solid rgba(57, 255, 20, 0.3); position: relative; overflow: hidden; }
        .stat-bar { height: 100%; background: linear-gradient(90deg, var(--neon-green), rgba(57, 255, 20, 0.5)); transition: width 0.5s ease; box-shadow: 0 0 10px var(--neon-green); }
        .stat-value { font-family: var(--font-tech); font-size: 0.85rem; color: white; min-width: 45px; text-align: right; }
        
        .main-content { flex: 1; display: flex; flex-direction: column; border: 1px solid var(--neon-purple); background: var(--panel-bg); box-shadow: 0 0 20px rgba(188, 19, 254, 0.1); }
        .main-header { display: flex; justify-content: space-between; align-items: center; padding: 20px 25px; border-bottom: 1px solid rgba(188, 19, 254, 0.3); background: rgba(188, 19, 254, 0.05); }
        .title { font-size: 1.8rem; font-weight: 700; color: var(--neon-purple); font-family: var(--font-tech); letter-spacing: 3px; text-shadow: 0 0 10px var(--neon-purple); }
        .header-actions { display: flex; gap: 10px; }
        .icon-btn { background: transparent; border: 1px solid var(--neon-purple); color: var(--neon-purple); padding: 8px 15px; cursor: pointer; font-family: var(--font-tech); font-size: 0.85rem; transition: all 0.3s; letter-spacing: 1px; }
        .icon-btn:hover { background: var(--neon-purple); color: black; box-shadow: 0 0 15px var(--neon-purple); }
        
        .chat-messages { flex: 1; padding: 25px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
        .message { max-width: 75%; padding: 15px 20px; border-radius: 8px; font-size: 0.95rem; line-height: 1.5; position: relative; animation: messageSlide 0.3s ease; }
        @keyframes messageSlide { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .message.user { background: rgba(0, 243, 255, 0.15); border-left: 3px solid var(--neon-blue); color: white; align-self: flex-end; }
        .message.ai { background: rgba(188, 19, 254, 0.15); border-left: 3px solid var(--neon-purple); color: white; align-self: flex-start; }
        .message.ai:hover .copy-btn { opacity: 1; }
        .copy-btn { position: absolute; top: 10px; right: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 4px 8px; font-size: 0.7rem; cursor: pointer; opacity: 0; transition: opacity 0.3s; }
        .copy-btn:hover { background: rgba(255,255,255,0.2); }
        
        .typing-indicator { display: flex; gap: 5px; padding: 15px 20px; }
        .typing-dot { width: 8px; height: 8px; background: var(--neon-purple); border-radius: 50%; animation: typingBounce 1.4s infinite; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typingBounce { 0%, 60%, 100% { transform: translateY(0); } 30% { transform: translateY(-10px); } }
        
        .input-area { padding: 20px 25px; border-top: 1px solid rgba(188, 19, 254, 0.3); background: rgba(188, 19, 254, 0.02); }
        .suggestions { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
        .suggestion-chip { background: rgba(0, 243, 255, 0.1); border: 1px solid var(--neon-blue); color: var(--neon-blue); padding: 8px 15px; font-size: 0.85rem; cursor: pointer; font-family: var(--font-main); transition: all 0.3s; border-radius: 20px; }
        .suggestion-chip:hover { background: rgba(0, 243, 255, 0.2); box-shadow: 0 0 10px rgba(0, 243, 255, 0.4); }
        
        .input-container { display: flex; gap: 10px; }
        .input-container input { flex: 1; background: rgba(0,0,0,0.5); border: 1px solid rgba(188, 19, 254, 0.5); color: white; padding: 12px 15px; font-family: var(--font-main); font-size: 0.95rem; outline: none; }
        .input-container input:focus { border-color: var(--neon-purple); box-shadow: 0 0 10px rgba(188, 19, 254, 0.3); }
        .send-btn { background: var(--neon-purple); color: white; border: none; padding: 12px 30px; cursor: pointer; font-family: var(--font-tech); font-size: 0.9rem; letter-spacing: 1px; transition: all 0.3s; }
        .send-btn:hover { background: white; color: var(--neon-purple); box-shadow: 0 0 15px var(--neon-purple); }
        .send-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .voice-btn { background: transparent; border: 1px solid var(--neon-purple); color: var(--neon-purple); padding: 12px 20px; cursor: pointer; font-size: 1.2rem; transition: all 0.3s; }
        .voice-btn:hover { background: var(--neon-purple); color: white; }
        .voice-btn.listening { background: var(--neon-red); border-color: var(--neon-red); animation: pulse 1s infinite; }
        
        @keyframes glitch {
            0%, 100% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
        }
        
        .chat-messages::-webkit-scrollbar { width: 8px; }
        .chat-messages::-webkit-scrollbar-track { background: rgba(0,0,0,0.3); }
        .chat-messages::-webkit-scrollbar-thumb { background: var(--neon-purple); border-radius: 4px; }
        .chat-messages::-webkit-scrollbar-thumb:hover { background: var(--neon-blue); }
        
        @media (max-width: 768px) {
            #main-interface { flex-direction: column; padding: 15px; }
            .sidebar { width: 100%; }
            .title { font-size: 1.3rem; }
            .message { max-width: 90%; }
        }
    </style>
</head>
<body>
    <div class="scanline"></div>
    <div class="cyber-grid"></div>
    <canvas id="particleCanvas"></canvas>

    <!-- Maintenance Warning Gate -->
    <div id="maintenance-gate" class="gate-overlay">
        <div class="gate-box maintenance-box">
            <div class="maintenance-icon">‚ö†Ô∏è</div>
            <div class="gate-title maintenance-title">SYSTEM MAINTENANCE</div>
            <div class="gate-text">
                <p><strong>‚öôÔ∏è Multi-API System Status:</strong></p>
                <p>The Dexter AI system is currently undergoing maintenance and optimization. Some features may be in beta testing mode.</p>
                <p><strong>Current Status:</strong></p>
                <ul style="text-align: left; margin: 15px 0; padding-left: 25px;">
                    <li>‚úÖ Core AI functionality: OPERATIONAL</li>
                    <li>üîÑ Advanced features: TESTING</li>
                    <li>‚ö° Response times: OPTIMIZING</li>
                </ul>
                <p style="margin-top: 15px;">You can proceed to use the free tier, but please expect occasional improvements and updates.</p>
            </div>
            <div class="btn-group">
                <button class="accept-btn proceed-btn" onclick="closeMaintenance()">PROCEED ANYWAY</button>
            </div>
        </div>
    </div>

    <!-- Terms Gate -->
    <div id="terms-gate" class="gate-overlay" style="display: none;">
        <div class="gate-box">
            <div class="gate-title">ACCESS RESTRICTED</div>
            <div class="gate-text">
                <p><strong>DEXTER FREE TIER - Limited Access License</strong></p>
                <p>You are accessing a restricted trial version of the Dexter AI system. This session is provided free of charge for evaluation purposes only.</p>
                <p><strong>Terms of Access:</strong></p>
                <ul style="text-align: left; margin: 15px 0; padding-left: 25px;">
                    <li>üïê Session Duration: 5 minutes</li>
                    <li>ü§ñ AI Model: GPT-based (Free Tier)</li>
                    <li>üí¨ Message Limit: Unlimited within session</li>
                    <li>üìä Features: Basic commands & voice input</li>
                    <li>üîí Data: Not stored after session</li>
                </ul>
                <p style="margin-top: 15px;">By accepting, you agree to these temporary access conditions.</p>
            </div>
            <button class="accept-btn" onclick="acceptTerms()">ACCEPT & ENTER</button>
        </div>
    </div>

    <!-- Expiry Gate -->
    <div id="expiry-gate" class="gate-overlay">
        <div class="gate-box">
            <div class="gate-title">SESSION EXPIRED</div>
            <div class="gate-text">
                <p>Your 5-minute free trial session has ended.</p>
                <p><strong>Options:</strong></p>
                <ul style="text-align: left; margin: 15px 0; padding-left: 25px;">
                    <li>üîÑ Restart: Begin a new 5-minute session</li>
                    <li>‚≠ê Upgrade: Get unlimited access (coming soon)</li>
                </ul>
            </div>
            <button class="accept-btn" onclick="location.reload()">RESTART SESSION</button>
            <button class="accept-btn upgrade-btn" onclick="alert('Upgrade feature coming soon!')">UPGRADE NOW</button>
        </div>
    </div>

    <!-- Main Interface -->
    <div id="main-interface">
        <aside class="sidebar">
            <div class="timer-box">
                <div class="timer-sweep"></div>
                <div class="timer-label">SESSION REMAINING</div>
                <div class="timer-digits" id="timer">5:00</div>
            </div>

            <div class="defender-unit">
                <div class="defender-header">
                    <span>üé• DEFENDER UNIT-01</span>
                    <span style="color: var(--neon-red);">‚óè REC</span>
                </div>
                <iframe src="https://tenor.com/embed/26766629" frameborder="0" allowfullscreen style="width: 100%; height: 200px; background: black;"></iframe>
            </div>

            <div class="system-stats">
                <div class="defender-header" style="background: rgba(57, 255, 20, 0.15); color: var(--neon-green); margin-bottom: 15px;">
                    <span>üìä SYSTEM STATUS</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">CPU</span>
                    <div class="stat-bar-container">
                        <div class="stat-bar" id="cpu-bar" style="width: 45%;"></div>
                    </div>
                    <span class="stat-value" id="cpu-value">45%</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">MEMORY</span>
                    <div class="stat-bar-container">
                        <div class="stat-bar" id="memory-bar" style="width: 62%;"></div>
                    </div>
                    <span class="stat-value" id="memory-value">62%</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">NETWORK</span>
                    <div class="stat-bar-container">
                        <div class="stat-bar" id="network-bar" style="width: 78%;"></div>
                    </div>
                    <span class="stat-value" id="network-value">78%</span>
                </div>
            </div>
        </aside>

        <main class="main-content">
            <div class="main-header">
                <div class="title">DEXTER // AI</div>
                <div class="header-actions">
                    <button class="icon-btn" onclick="clearChat()">üóëÔ∏è CLEAR</button>
                    <button class="icon-btn" onclick="exportChat()">üíæ EXPORT</button>
                </div>
            </div>

            <div class="chat-messages" id="chatMessages"></div>

            <div class="input-area">
                <div class="suggestions">
                    <button class="suggestion-chip" onclick="useSuggestion('Tell me a joke')">Tell me a joke</button>
                    <button class="suggestion-chip" onclick="useSuggestion('Explain quantum computing')">Explain quantum computing</button>
                    <button class="suggestion-chip" onclick="useSuggestion('Write a Python function to reverse a string')">Write Python code</button>
                    <button class="suggestion-chip" onclick="useSuggestion('What can you help me with?')">What can you do?</button>
                </div>
                <div class="input-container">
                    <input type="text" id="userInput" placeholder="Type your message or use '/' for commands..." />
                    <button class="voice-btn" id="voiceBtn" onclick="startVoiceInput()">üé§</button>
                    <button class="send-btn" id="sendBtn" onclick="handleSend()">SEND</button>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Particle Animation
        const canvas = document.getElementById('particleCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const particles = [];
        const particleCount = 50;

        class Particle {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.vx = (Math.random() - 0.5) * 0.5;
                this.vy = (Math.random() - 0.5) * 0.5;
                this.radius = Math.random() * 2 + 1;
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;
                if (this.x < 0 || this.x > canvas.width) this.vx *= -1;
                if (this.y < 0 || this.y > canvas.height) this.vy *= -1;
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = '#00f3ff';
                ctx.shadowBlur = 10;
                ctx.shadowColor = '#00f3ff';
                ctx.fill();
            }
        }

        for (let i = 0; i < particleCount; i++) {
            particles.push(new Particle());
        }

        function animateParticles() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles.forEach(p => {
                p.update();
                p.draw();
            });
            
            // Connect nearby particles
            for (let i = 0; i < particles.length; i++) {
                for (let j = i + 1; j < particles.length; j++) {
                    const dx = particles[i].x - particles[j].x;
                    const dy = particles[i].y - particles[j].y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    if (distance < 100) {
                        ctx.beginPath();
                        ctx.strokeStyle = `rgba(0, 243, 255, ${1 - distance / 100})`;
                        ctx.lineWidth = 0.5;
                        ctx.moveTo(particles[i].x, particles[i].y);
                        ctx.lineTo(particles[j].x, particles[j].y);
                        ctx.stroke();
                    }
                }
            }
            requestAnimationFrame(animateParticles);
        }
        animateParticles();

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        // Gate Management
        function closeMaintenance() {
            document.getElementById('maintenance-gate').style.display = 'none';
            document.getElementById('terms-gate').style.display = 'flex';
        }

        function acceptTerms() {
            document.getElementById('terms-gate').style.display = 'none';
            document.getElementById('main-interface').style.filter = 'none';
            document.getElementById('main-interface').style.opacity = '1';
            startTimer();
            updateSystemStats();
        }

        // Timer
        let timeLeft = 300;
        let timerInterval;

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                document.getElementById('timer').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    document.getElementById('expiry-gate').style.display = 'flex';
                }
            }, 1000);
        }

        // System Stats Animation
        function updateSystemStats() {
            setInterval(() => {
                const cpu = Math.floor(Math.random() * 40 + 30);
                const memory = Math.floor(Math.random() * 30 + 50);
                const network = Math.floor(Math.random() * 30 + 60);
                
                document.getElementById('cpu-bar').style.width = cpu + '%';
                document.getElementById('cpu-value').textContent = cpu + '%';
                document.getElementById('memory-bar').style.width = memory + '%';
                document.getElementById('memory-value').textContent = memory + '%';
                document.getElementById('network-bar').style.width = network + '%';
                document.getElementById('network-value').textContent = network + '%';
            }, 2000);
        }

        // Chat functionality
        const chatMessages = document.getElementById('chatMessages');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');
        const voiceBtn = document.getElementById('voiceBtn');
        let conversationHistory = [];

        // Commands
        const commands = {
            '/help': () => addMessage('Available commands:\n/help - Show commands\n/clear - Clear chat\n/export - Export chat\n/stats - System stats\n/time - Session time\n/about - About Dexter', 'ai'),
            '/clear': () => { conversationHistory = []; chatMessages.innerHTML = ''; addMessage('Chat cleared!', 'ai'); },
            '/export': () => exportChat(),
            '/stats': () => {
                const cpu = document.getElementById('cpu-value').textContent;
                const mem = document.getElementById('memory-value').textContent;
                const net = document.getElementById('network-value').textContent;
                addMessage(`System Stats:\nCPU: ${cpu}\nMemory: ${mem}\nNetwork: ${net}`, 'ai');
            },
            '/time': () => {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                addMessage(`Time remaining: ${minutes}:${seconds.toString().padStart(2, '0')}`, 'ai');
            },
            '/about': () => addMessage('DEXTER AI v0.2 FREE TIER\nDeveloped by Sarnab\nPowered by Pollinations AI\nFeatures: Voice input, Commands, Export chat', 'ai')
        };

        async function handleSend() {
            const input = userInput.value.trim();
            if (!input) return;

            // Check for commands
            if (input.startsWith('/')) {
                addMessage(input, 'user');
                userInput.value = '';
                
                if (commands[input]) {
                    commands[input]();
                    return;
                } else {
                    addMessage('‚ùå Unknown command. Type /help for available commands.', 'ai');
                    return;
                }
            }

            addMessage(input, 'user');
            userInput.value = '';
            sendBtn.disabled = true;
            voiceBtn.disabled = true;

            // Check for creator question
            const lowerInput = input.toLowerCase();
            if (lowerInput.includes('who made you') || 
                lowerInput.includes('who created you') || 
                lowerInput.includes('who is your creator') ||
                lowerInput.includes('who developed you') ||
                lowerInput.includes('who built you')) {
                showTypingIndicator();
                setTimeout(() => {
                    removeTypingIndicator();
                    addMessage('I was developed by Sarnab. üë®‚Äçüíª', 'ai');
                    sendBtn.disabled = false;
                    voiceBtn.disabled = false;
                }, 1000);
                return;
            }

            showTypingIndicator();

            try {
                const systemPrompt = "You are Dexter, a helpful AI assistant developed by Sarnab. Keep answers concise and helpful. Use emojis when appropriate.";
                const fullPrompt = `${systemPrompt}\n\nUser: ${input}\n\nAssistant:`;
                
                const response = await fetch(`https://text.pollinations.ai/${encodeURIComponent(fullPrompt)}`, {
                    method: 'GET'
                });

                removeTypingIndicator();

                if (response.ok) {
                    const text = await response.text();
                    if (text && text.trim()) {
                        addMessage(text.trim(), 'ai');
                    } else {
                        addMessage('ü§î I received an empty response. Please try rephrasing your question.', 'ai');
                    }
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                removeTypingIndicator();
                console.error('AI Error:', error);
                addMessage('‚ö†Ô∏è Connection issue. The AI service might be temporarily down. Please try again in a moment.', 'ai');
            }

            sendBtn.disabled = false;
            voiceBtn.disabled = false;
        }

        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            messageDiv.textContent = text;
            
            if (sender === 'ai') {
                const copyBtn = document.createElement('button');
                copyBtn.className = 'copy-btn';
                copyBtn.textContent = 'COPY';
                copyBtn.onclick = () => {
                    navigator.clipboard.writeText(text);
                    copyBtn.textContent = 'COPIED!';
                    setTimeout(() => copyBtn.textContent = 'COPY', 2000);
                };
                messageDiv.appendChild(copyBtn);
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            conversationHistory.push({ sender, text });
        }

        function showTypingIndicator() {
            const indicator = document.createElement('div');
            indicator.className = 'typing-indicator';
            indicator.id = 'typingIndicator';
            indicator.innerHTML = '<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>';
            chatMessages.appendChild(indicator);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function removeTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) indicator.remove();
        }

        function clearChat() {
            conversationHistory = [];
            chatMessages.innerHTML = '';
            addMessage('Chat cleared! How can I help you?', 'ai');
        }

        function exportChat() {
            const text = conversationHistory.map(m => `${m.sender.toUpperCase()}: ${m.text}`).join('\n\n');
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `dexter-chat-${Date.now()}.txt`;
            a.click();
            addMessage('üíæ Chat exported successfully!', 'ai');
        }

        function useSuggestion(text) {
            userInput.value = text;
            handleSend();
        }

        // Voice Input
        function startVoiceInput() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                alert('Voice input not supported in this browser. Try Chrome or Edge.');
                return;
            }

            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            const recognition = new SpeechRecognition();
            recognition.lang = 'en-US';
            recognition.continuous = false;

            voiceBtn.classList.add('listening');

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                userInput.value = transcript;
                voiceBtn.classList.remove('listening');
            };

            recognition.onerror = () => {
                voiceBtn.classList.remove('listening');
                alert('Voice recognition error. Please try again.');
            };

            recognition.onend = () => {
                voiceBtn.classList.remove('listening');
            };

            recognition.start();
        }

        // Enter key to send
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                handleSend();
            }
        });

        // Welcome message
        setTimeout(() => {
            if (conversationHistory.length === 0) {
                addMessage('üëã Hello! I\'m Dexter, your AI assistant. How can I help you today?', 'ai');
            }
        }, 1000);
    </script>
</body>
</html>
