async function handleSend(val, loadId) {
    try {
        const response = await fetch('https://text.pollinations.ai/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                messages: [
                    { role: 'system', content: systemPrompt },
                    { role: 'user', content: val }
                ],
                model: 'openai'
            })
        });

        if (response.ok) {
            const text = await response.text();
            document.getElementById(loadId).remove();
            addMsg(text || "[NO RESPONSE]", 'ai');
        } else {
            document.getElementById(loadId).remove();
            const errorText = await response.text().catch(() => '');
            console.error('API Error:', response.status, errorText);
            addMsg(`[SYSTEM ERROR]: API returned ${response.status}. Trying fallback...`, 'ai');
            // Fallback to simpler GET endpoint if the POST fails.
            const fallbackResponse = await fetch(`https://text.pollinations.ai/${encodeURIComponent(val)}?system=${encodeURIComponent(systemPrompt)}`);
            if (fallbackResponse.ok) {
                const fallbackText = await fallbackResponse.text();
                addMsg(fallbackText || "[NO RESPONSE]", 'ai');
            } else {
                addMsg(`[FALLBACK ERROR]: API returned ${fallbackResponse.status}.`, 'ai');
            }
        }
    } catch (error) {
        console.error('Unexpected Error:', error);
        addMsg(`[UNEXPECTED ERROR]: ${error.message}`, 'ai');
    }
}