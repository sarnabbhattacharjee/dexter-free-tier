<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dexter - AI Assistant</title>
</head>
<body>
    <div id="chatbox"></div>
    <input id="input" type="text">
    <button id="sendBtn">Send</button>
    <button id="voiceBtn">ðŸŽ¤</button>
    <script>
        const input = document.getElementById('input');
        const chatbox = document.getElementById('chatbox');
        const btn = document.getElementById('sendBtn');
        const voiceBtn = document.getElementById('voiceBtn');
        
        function addMsg(msg, from) {
            const msgDiv = document.createElement('div');
            msgDiv.className = from;
            msgDiv.innerText = msg;
            chatbox.appendChild(msgDiv);
        }
        
        function showTypingIndicator() {
            addMsg('...', 'ai');
        }
        
        function removeTypingIndicator() {
            const lastMsg = chatbox.lastChild;
            if (lastMsg && lastMsg.className === 'ai' && lastMsg.innerText === '...') {
                chatbox.removeChild(lastMsg);
            }
        }
        
        function handleCommand(command) {
            // Command handling logic here
            return false;
        }
        
        async function handleSend() {
            const val = input.value.trim();
            if(!val) return;
            
            // Check for commands
            if (val.startsWith('/')) {
                addMsg(val, 'user');
                input.value = '';
                if (handleCommand(val)) {
                    return;
                } else {
                    addMsg(`âŒ Unknown command. Type /help for available commands.`, 'ai');
                    return;
                }
            }
            
            addMsg(val, 'user');
            input.value = '';
            input.disabled = true;
            btn.disabled = true;
            voiceBtn.disabled = true;
            
            const lowerVal = val.toLowerCase();
            if (lowerVal.includes("who made you") || 
                lowerVal.includes("who created you") || 
                lowerVal.includes("who is your creator") ||
                lowerVal.includes("who developed you") ||
                lowerVal.includes("who built you")) {
                showTypingIndicator();
                setTimeout(() => {
                    removeTypingIndicator();
                    addMsg("I was developed by Sarnab. ðŸ‘¨â€ðŸ’»", 'ai');
                    input.disabled = false;
                    btn.disabled = false;
                    voiceBtn.disabled = false;
                    input.focus();
                }, 1000);
                return;
            }
            
            showTypingIndicator();
            
            try {
                // Use the simple Pollinations AI endpoint
                const systemPrompt = "You are Dexter, a helpful AI assistant developed by Sarnab. Keep answers concise and helpful. Use emojis when appropriate.";
                const fullPrompt = `${systemPrompt}\n\nUser: ${val}\n\nAssistant:`;
                
                const response = await fetch(`https://text.pollinations.ai/${encodeURIComponent(fullPrompt)}`, {
                    method: 'GET',
                    headers: {
                        'Accept': 'text/plain'
                    }
                });
                
                removeTypingIndicator();
                
                if (response.ok) {
                    const text = await response.text();
                    if (text && text.trim()) {
                        addMsg(text.trim(), 'ai');
                    } else {
                        addMsg("ðŸ¤” I received an empty response. Please try rephrasing your question.", 'ai');
                    }
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
                
            } catch(e) {
                removeTypingIndicator();
                console.error('AI Error:', e);
                addMsg("âš ï¸ Connection issue. The AI service might be temporarily down. Please try again in a moment.", 'ai');
            }
            
            if (timeRemaining > 0) {
                input.disabled = false;
                btn.disabled = false;
                voiceBtn.disabled = false;
                input.focus();
            }
        }

        btn.addEventListener('click', handleSend);
        voiceBtn.addEventListener('click', handleSend);
    </script>
</body>
</html>
