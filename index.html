async function handleSend() {
    const val = input.value.trim();
    if(!val) return;
    if (val.startsWith('/')) {
        addMsg(val, 'user');
        input.value = '';
        if (handleCommand(val)) {
            return;
        } else {
            addMsg(`âŒ Unknown command. Type /help for available commands.`, 'ai');
            return;
        }
    }
    addMsg(val, 'user');
    input.value = '';
    input.disabled = true;
    btn.disabled = true;
    voiceBtn.disabled = true;
    const lowerVal = val.toLowerCase();
    if (lowerVal.includes("who made you") || 
        lowerVal.includes("who created you") || 
        lowerVal.includes("who is your creator") ||
        lowerVal.includes("who developed you") ||
        lowerVal.includes("who built you")) {
        showTypingIndicator();
        setTimeout(() => {
            removeTypingIndicator();
            addMsg("I was developed by Sarnab. ðŸ‘¨â€ðŸ’»", 'ai');
            input.disabled = false;
            btn.disabled = false;
            voiceBtn.disabled = false;
            input.focus();
        }, 1000);
        return;
    }
    showTypingIndicator();
    try {
        // Try the simple GET endpoint first - this is more reliable
        const response = await fetch(`https://text.pollinations.ai/${encodeURIComponent(val)}`, {
            method: 'GET'
        });
        
        removeTypingIndicator();
        
        if (response.ok) {
            const text = await response.text();
            if (text && text.trim()) {
                addMsg(text.trim(), 'ai');
            } else {
                addMsg("ðŸ¤” I received an empty response. Please try rephrasing your question.", 'ai');
            }
        } else {
            throw new Error(`HTTP ${response.status}`);
        }
    } catch(e) {
        removeTypingIndicator();
        console.error('AI Error:', e);
        
        // Provide a helpful response even when API fails
        const keywords = val.toLowerCase();
        let fallbackMsg = "";
        
        if (keywords.includes("hello") || keywords.includes("hi")) {
            fallbackMsg = "ðŸ‘‹ Hello! I'm Dexter, your AI assistant. The AI service is currently experiencing issues, but I'm here to help! Try asking me something else or type /help for commands.";
        } else if (keywords.includes("help")) {
            fallbackMsg = "ðŸ’¡ I'd love to help! The AI service is temporarily down, but you can use commands like /help, /stats, /time, or /about to interact with the system.";
        } else {
            fallbackMsg = `âš ï¸ I received your message: "${val}". Unfortunately, the AI service is temporarily unavailable. Please try again in a moment, or use /help to see available commands.`;
        }
        
        addMsg(fallbackMsg, 'ai');
    }
    if (timeRemaining > 0) {
        input.disabled = false;
        btn.disabled = false;
        voiceBtn.disabled = false;
        input.focus();
    }
}